<html>

<head>
    <title>Joc de Cuina | Miquel</title>
    <script src="js/aframe.min.js"></script>
    <!-- <script src="js/aframe-physics-system.min.js"></script> -->
    <script src="https://unpkg.com/aframe-physics-extras/dist/aframe-physics-extras.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.1.0/dist/aframe-physics-system.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.1.1/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-gltf-part-component/dist/aframe-gltf-part-component.min.js"></script>
    <script
        src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands/dist/super-hands.min.js"></script>
</head>

<body>
    <a-scene physics="debug: true;">
        <a-assets>
            <a-mixin id="grab" geometry="primitive: box; width: 0.1; height: 0.1; depth: 0.1" hoverable grabbable
                stretchable draggable event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
                event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false" dynamic-body
                shadow></a-mixin>

            <!-- <a-mixin id="grab" geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" hoverable grabbable
                stretchable draggable droppable shadow
                event-set__dragdrop="_event: drag-drop; geometry.primitive: sphere; geometry.radius: 0.25"
                event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
                event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false"
                event-set__dragon="_event: dragover-start; material.wireframe: true"
                event-set__dragoff="_event: dragover-end; material.wireframe: false">
            </a-mixin> -->

            <a-mixin id="all-interactions" hoverable grabbable stretchable draggable
                event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
                event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false" dynamic-body></a-mixin>

            <a-mixin id="grab-move" hoverable grabbable draggable
                event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
                event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false" dynamic-body>
            </a-mixin>

            <a-mixin id="physics-hands" physics-collider phase-shift collision-filter="collisionForces: false"
                static-body="shape: sphere; sphereRadius: 0.02" super-hands="colliderEvent: collisions;
                              colliderEventProperty: els;
                              colliderEndEvent: collisions;
                              colliderEndEventProperty: clearedEls;">
            </a-mixin>

            <a-mixin id="touch" physics-collider phase-shift collision-filter="collisionForces: false"
                static-body="shape: sphere; sphereRadius: 0.02" super-hands="colliderEvent: collisions;
                              colliderEventProperty: els;
                              colliderEndEvent: collisions;
                              colliderEndEventProperty: clearedEls;">
            </a-mixin>

            <!-- <a-entity id="audioEntity">
                <a-sound src="url(assets/sounds/intro.mp3)" autoplay="true" loop="true" volume="1"></a-sound>
            </a-entity> -->
            <a-sound id="sound" src="assets/sounds/fallo.mp3" preload="auto"></a-sound>
            <a-sound id="house" src="assets/sounds/house_lo.mp3" preload="auto"></a-sound>
            <a-sound id="doorSound" src="assets/sounds/door.mp3" preload="auto"></a-sound>
            <img src="assets/sky2.jpg" id="sky">
            <img id="city" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/city.jpg" crossorigin>
            <img id="city-thumb" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-city.jpg"
                crossorigin>
            <img id="cubes" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/cubes.jpg" crossorigin>
            <img id="cubes-thumb" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-cubes.jpg"
                crossorigin>
            <img id="sechelt" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg" crossorigin>
            <img id="sechelt-thumb" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/thumb-sechelt.jpg"
                crossorigin>
            <a-asset-item id="mi-animacion" src="assets/animacion_corte.glb"></a-asset-item>
            <img id="textura-madera" src="assets/madera.jpg">
        </a-assets>

        <a-sky id="image-360" src="#city"
            animation__fade="property: components.material.material.color; type: color; from: #FFF; to: #000; dur: 300; startEvents: fade"
            animation__fadeback="property: components.material.material.color; type: color; from: #000; to: #FFF; dur: 300; startEvents: animationcomplete__fade"></a-sky>

        <!-- <a-entity id="rig" movement-controls position="0 0.6 0" play-on-wasd>
            <a-camera position="0 0 0" wasd-controls="fly: false; acceleration: 10" look-controls
                raycaster="objects: .colisionable">
                <a-cursor id="cursor"
                animation__click="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; easing: easeInCubic; dur: 150; startEvents: click"
                animation__clickreset="property: scale; to: 0.1 0.1 0.1; dur: 1; startEvents: animationcomplete__click"
                animation__fusing="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; easing: easeInCubic; dur: 150; startEvents: fusing">
            </a-cursor> </a-camera>
            
            <a-sound id="footsteps" src="assets/sounds/pasos.mp3" preload="auto" loop="true" poolSize="4"
                volume="0.3"></a-sound> 
        </a-entity> -->

        <a-entity id="rig" movement-controls position="0 1.5 0">
            <a-camera position="0 0 0" wasd-controls="fly: false; acceleration: 10"></a-camera>
            <a-entity camera wasd-controls position="0 1 1" capture-mouse raycaster="objects: .grab"
                cursor="rayOrigin:mouse" static-body="shape: sphere; sphereRadius: 0.001" super-hands="colliderEvent: raycaster-intersection;
                             colliderEventProperty: els;
                             colliderEndEvent:raycaster-intersection-cleared;
                             colliderEndEventProperty: clearedEls;">

            </a-entity>
            <!-- <a-entity id="rhand" mixin="physics-hands" hand-controls="hand: right">
            </a-entity>
            <a-entity id="lhand" mixin="physics-hands" hand-controls="hand: left">
            </a-entity> -->

            <a-sound id="footsteps" src="assets/sounds/pasos.mp3" preload="auto" loop="true" poolSize="4"
                volume="0.3"></a-sound>
        </a-entity>

        <script>
            // turn controller's physics presence on only while button held down
            AFRAME.registerComponent('phase-shift', {
                init: function () {
                    var el = this.el
                    el.addEventListener('gripdown', function () {
                        el.setAttribute('collision-filter', { collisionForces: true })
                    })
                    el.addEventListener('gripup', function () {
                        el.setAttribute('collision-filter', { collisionForces: false })
                    })
                }
            })
        </script>

        <!-- LUCES -->
        <a-light type="ambient" color="#ffffff"></a-light>
        <a-light type="directional" color="#ffffff" intensity="0.4" position="0 4 -3"></a-light>

        <!-- Suelo y techo a-->
        <a-entity id="floor" geometry="primitive: plane; width: 30; height: 30"
            material="src: #textura-madera; repeat: 10 10; metalness: 0.5; roughness: 1;" position="0 -0.5 0"
            rotation="-90 0 0" depth="0.2" static-body></a-entity>
        <a-entity id="roof" geometry="primitive: plane; width: 30; height: 30"
            material="src: #textura-madera; repeat: 10 10; metalness: 0.5; roughness: 1;" position="0 9 0"
            rotation="90 0 0" depth="0.2" static-body></a-entity>

        <!-- Objectes -->

        <a-entity class="grab" mixin="grab" position="-1 1 -3" material="color: red" reset="resetPosition: -1 2 -3"
            colocado-en-tabla></a-entity>

        <a-entity id="shaker" gltf-model="url(assets/batidora.glb)" position="2.5 0.65 -2.6" rotation="0 -90 0" scale="0.2 0.2 0.2"
            vibrate-on-click progress-bar></a-entity>

        <a-entity id="fireSource" gltf-model="url(assets/fogons.glb)" position="-2.2 0.55 -3" rotation="0 0 0"
            scale="0.065 0.065 0.065"></a-entity>

        <a-entity id="woodenTable" gltf-model="url(assets/wooden_table.glb)" position="7 0 -3"
            rotation="0 70 0"></a-entity>

        <a-entity id="fryingPan" mixin="grab" class="grab" gltf-model="url(assets/frying_pan.glb)" position="-2 2 -3"
            rotation="0 0 0" scale="0.02 0.02 0.02" reset="resetPosition: 0 2 -3">
        </a-entity>

        <a-entity id="kitchenKnife" mixin="grab" class="grab" gltf-model="url(assets/kitchen_knife.glb)" position="1 0.8 -3"
            rotation="0 0 0" scale="1.5 1.5 1.5" reset="resetPosition: 0 1.2 -3" detectar-golpe>
        </a-entity>

        <a-plane id="tabla" position="1 0.52 -3" rotation="-90 0 0" width="1.5" height="0.5" color="#562701"
            src="assets/madera.jpg" static-body></a-plane>

        <a-entity text="value: Coge los ingredientes; color: white; align: center; width: 6;" position="7 3 -3"
            rotation="0 -20 0"></a-entity>

        <!-- Paredes -->
        <a-box position="0 4 -15" width="30" height="10" depth="1" color="gray" static-body></a-box>
        <!-- Pared detras -->
        <a-box class="colisionable" position="0 4 15" width="30" height="10" depth="1" color="gray" static-body></a-box>
        <!-- Pared delante -->
        <a-box position="-15 4 0" width="1" height="10" depth="10" color="gray" transparent="true" opacity="0.5"
            static-body></a-box> <!-- Pared izq ventana-->
        <a-box position="-15 4 10" width="1" height="10" depth="10" color="gray" static-body></a-box> <!-- Pared izq -->
        <a-box position="-15 4 -10" width="1" height="10" depth="10" color="gray" static-body></a-box>
        <!-- Pared izq -->
        <a-box position="15 4 0" width="1" height="10" depth="10" color="gray" transparent="true" opacity="0.5"
            static-body></a-box> <!-- Pared der -->
        <a-box position="15 4 10" width="1" height="10" depth="10" color="gray" static-body></a-box> <!-- Pared der -->
        <a-box position="15 4 -10" width="1" height="10" depth="10" color="gray" static-body></a-box> <!-- Pared der -->

        <!-- Encimera -->
        <a-box position="0 0 -3" depth="1.5" height="1" width="8"
            material="src: url(assets/images/granite.jpg); repeat: 4 2; metalness: 0.5" color="#FFF" static-body>
        </a-box> <!-- Lateral izquierdo -->
        <a-box position="-4.1 0.25 -3" width="0.2" height="0.5" depth="1.5" color="#d2b48c" static-body></a-box>
        <!-- Lateral derecho -->
        <a-box position="4.1 0.25 -3" width="0.2" height="0.5" depth="1.5" color="#d2b48c" static-body></a-box>
        <!-- Trasera -->
        <a-box position="0 2 -3.85" width="8.4" height="4" depth="0.2" color="#d2b48c" static-body></a-box>

        <a-box position="1 3 -3.7" width="2.5" height="0.2" depth="0.1" color="grey" static-body></a-box>

        <!-- Armario -->
        <a-entity id="mueblePuerta" position="3 2 -3.7" scale="0.7 0.7 0.7" puerta>
            <!-- Partes de la nevera -->
            <a-box id="arriba" width="2" height="0.1" depth="1" src="assets/madera.jpg" position="0 1 0.5"
                rotation="0 0 0"></a-box>
            <a-box id="detras" width="2" height="0.1" depth="2" src="assets/madera.jpg" position="0 0 0"
                rotation="90 0 0"></a-box>
            <a-box id="bajo" width="2" height="0.1" depth="1" src="assets/madera.jpg" position="0 -1 0.5"
                rotation="0 0 0"></a-box>
            <a-box class="puerta" width="2" height="0.1" depth="2" src="assets/madera.jpg" position="0 0 1"
                rotation="90 0 0">
                <!-- Pomo -->
                <a-box id="pomo" width="0.1" height="0.4" depth="0.2" color="white" position="0.7 0.1 -0.3"
                    rotation="90 0 0"></a-box>
            </a-box>
            <a-box id="der" width="1" height="2" depth="0.1" color="white" position="1 0 0.5" rotation="0 90 0"></a-box>
            <a-box id="izq" width="1" height="2" depth="0.1" color="white" position="-1 0 0.5"
                rotation="0 -90 0"></a-box>
        </a-entity>

        <!-- Nevera -->
        <a-entity id="mueblePuerta" position="-5.2 0 -3" scale="0.7 0.7 0.7" puerta>
            <!-- Partes de la nevera -->
            <a-box id="arriba" width="2" height="0.1" depth="2" color="#FFF" position="0 1 0" rotation="0 0 0"></a-box>
            <a-box id="detras" width="2" height="0.1" depth="2" color="#FFF" position="0 0 -1"
                rotation="90 0 0"></a-box>
            <a-box id="bajo" width="2" height="0.1" depth="2" color="#FFF" position="0 -1 0" rotation="0 0 0"></a-box>
            <a-box class="puerta" width="2" height="0.1" depth="2" color="#FFF" position="0 0 1" rotation="90 0 0">
                <!-- Pomo -->
                <a-box id="pomo" width="0.1" height="0.4" depth="0.2" color="black" position="0.7 0.2 -0.3"
                    rotation="90 0 0"></a-box>
            </a-box>
            <a-box id="der" width="2" height="2" depth="0.1" color="#FFF" position="1 0 0" rotation="0 90 0"></a-box>
            <a-box id="izq" width="2" height="2" depth="0.1" color="#FFF" position="-1 0 0" rotation="0 -90 0"></a-box>
        </a-entity>

        <!-- Cambio de fondo -->
        <a-entity position="-14.4 1 9" rotation="0 90 0">
            <a-entity text="value: Cambiar el fondo; color: white; align: center; width: 8;"
                position="0 2 0"></a-entity>
            <!-- Enlace 1 -->
            <a-entity class="link" geometry="primitive: plane; height: 1; width: 1" material="shader: flat; src: #city"
                sound="src:#sound; on:click; poolSize: 4" event-set__mouseenter="scale: 1.2 1.2 1"
                event-set__mouseleave="scale: 1 1 1"
                event-set__click="_target: #image-360; _delay: 300; material.src: #city" position="-2 0 0">
            </a-entity>

            <!-- Enlace 2 -->
            <a-entity class="link" geometry="primitive: plane; height: 1; width: 1"
                material="shader: flat; src: #sechelt" event-set__mouseenter="scale: 1.2 1.2 1"
                event-set__mouseleave="scale: 1 1 1"
                event-set__click="_target: #image-360; _delay: 300; material.src: #sechelt" position="-0.5 0 0"
                sound="src:#house; on:click; poolSize: 4">
            </a-entity>

            <!-- Enlace 3 -->
            <a-entity class="link" geometry="primitive: plane; height: 1; width: 1" material="shader: flat; src: #cubes"
                event-set__mouseenter="scale: 1.2 1.2 1" event-set__mouseleave="scale: 1 1 1"
                event-set__click="_target: #image-360; _delay: 300; material.src: #cubes" position="1 0 0">
            </a-entity>

            <!-- Enlace 4 -->
            <a-entity class="link" geometry="primitive: plane; height: 1; width: 1" material="shader: flat; src: #city"
                sound="on: click; src: #sound" event-set__mouseenter="scale: 1.2 1.2 1"
                event-set__mouseleave="scale: 1 1 1"
                event-set__click="_target: #image-360; _delay: 300; material.src: #city" position="2.5 0 0">
            </a-entity>

            <a-entity id="menuOpciones" position="-4 0.5 0" rotation="0 0 0">
                <a-plane id="menuOpcionesButton" position="0 0 0" material="color: #0C9" width="2" height="0.5">
                    <a-text value="Opciones" align="center"></a-text>
                </a-plane>
            </a-entity>

            <!-- MenÃº de volumen, inicialmente no visible -->
            <a-entity id="menuVolumen" position="-2 1.5 0.8" rotation="0 0 0" visible="false">
                <a-plane id="volumenControl" position="0 0.5 0" material="color: #F00" width="2" height="0.5">
                    <a-text value="Volumen" align="center"></a-text>
                </a-plane>
                <a-plane id="retrocesoButton" position="0 -0.5 0" material="color: #0C9" width="2" height="0.3">
                    <a-text value="Volver" align="center"></a-text>
                </a-plane>
                <!-- Botones para ajustar el volumen -->
                <a-plane id="botonSubirVolumen" position="0.5 0 0" material="color: #0C9" width="0.75" height="0.2">
                    <a-text value="+" align="center"></a-text>
                </a-plane>
                <a-plane id="botonBajarVolumen" position="-0.5 0 0" material="color: #F00" width="0.75" height="0.2">
                    <a-text value="-" align="center"></a-text>
                </a-plane>
            </a-entity>
        </a-entity>
    </a-scene>
</body>

</html>